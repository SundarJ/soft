!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n(e.soft={})}(this,function(e){"use strict";function n(e,n){for(var r=0,t=-1+e.length,u=Math.floor((t+1)/2);u>=r;r++){if(e[r]===n)return!0;if(e[t-r]===n)return!0}return!1}function r(e,n){for(var r=-1,t=e.length;++r<t;)n(e[r],r,e)}function t(e,n){for(var r=-1,t=e.length,u=Array(t);++r<t;)u[r]=n(e[r],r,e);return u}function u(e,n){for(var r=-1,t=e.length,u=[];++r<t;)n(e[r])&&u.push(e[r]);return u}function o(e){return e.replace(E,"\\\\").replace(d,"\\'").replace(T,'\\"').replace(m,"\\n").replace(y,"\\r").replace(x,"\\u2028").replace(b,"\\u2029")}function i(e,n){return Array.prototype.concat.call(e).map(function(e){return(n||":")+e})}function c(e){return{ENTITY:["self","this","here"],ATTRIBUTE:i(["is","of","as"]),ELEMENT:i(["import","include","if","else","endif","fi"]),HELPER:i("as")}}function f(e){var n={t:e[1]},r=e[2];if(r){for(var t={},u=void 0;u=k.exec(r);)t[u[1]]=u[2]||!0;n.a=t}return n}function a(e){for(var n=[],r=e.length,t=0,u=void 0,o="";r>t;){var i=e.slice(t);"<"===i[0]?((u=A.exec(i))?(t+=u[0].length,u=f(u)):(u=I.exec(i))?(t+=u[0].length,u={t:"c"}):(u=j.exec(i))&&(t+=u[0].length,u=!1),u&&(o&&(n.push(o),o=""),n.push(u))):o+=e[t++]}return!u&&o?o:n}function l(e,n){var t=n[e];if("string"!=typeof t)return null;var u=void 0;(u=t.match(L))&&(n[e]=u,r(R.ATTRIBUTE,function(e){var r=n[e];if(r){u.soft={i:r.replace(N,"")};var t=n[R.HELPER];t&&(u.soft.h=t.replace(N,""))}}))}function p(e){var t=e.a,u=[];r(Object.keys(t),function(e,r,o){n(R.ATTRIBUTE,e)?u.push(e):l(e,t)}),r(u,function(e){return delete t[e]}),e.a=t}function s(e,n){var r=e.t;if(r){if("c"===r)return n.pop(),null;e.a&&p(e)}var t=n[n.length-1],u="string"==typeof e;return t?(t.c||(t.c=[]),t.c.push(e),u||B.test(r)||n.push(e),null):u?null:(B.test(r)||n.push(e),e)}function g(e){var n=a(e);if("string"==typeof n)return n;var r=[];return u(t(n,function(e){return r.length||"string"!=typeof e?s(e,r):e}),Boolean)}function h(e){var n=U[e]||(U[e]=g(e));return n=o(n.join("")),new Function("data","return '"+n+"'")}function v(e,n){return h(e)(n)}var d=/'/g,T=/"/g,m=/\n/g,y=/\r/g,E=/\\/g,x=/\u2028/,b=/\u2029/,R=c(),A=/^<([^ \/!]+?)( [^>]+)*?>/,I=/^<\/(?:[^ \/]+?)(?: [^>]+)*?>/,j=/^<!--(.+?)-->/,k=/([^= ]+)(?:=("[^"]*"|'[^']*'|[^"'\s>]*))?/g,B=/^(?:area|base|br|col|command|doctype|embed|hr|img|input|keygen|link|meta|param|source|track|wbr|import|include)$/i,w=R.ENTITY.join("|"),L=new RegExp("&(?:"+w+");|&(?:"+w+")(?:\\.([^;]+)|\\[([^\\]]+)\\]);"),N=/^['"]|['"]$/g,U={};e.parse=g,e.lex=a,e.compile=h,e.render=v});