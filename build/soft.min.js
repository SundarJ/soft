!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n(e.soft=e.soft||{})}(this,function(e){"use strict";function n(e,n){for(var r=0,t=-1+e.length,u=Math.floor((t+1)/2);u>=r;r++){if(e[r]===n)return!0;if(e[t-r]===n)return!0}return!1}function r(e,n){for(var r=-1,t=e.length;++r<t;)n(e[r],r,e)}function t(e,n){for(var r=-1,t=e.length,u=Array(t);++r<t;)u[r]=n(e[r],r,e);return u}function u(e,n){for(var r=-1,t=e.length,u=[];++r<t;)n(e[r])&&u.push(e[r]);return u}function i(e){return e.replace(b,"\\\\").replace(T,"\\'").replace(m,'\\"').replace(y,"\\n").replace(x,"\\r").replace(R,"\\u2028").replace(I,"\\u2029")}function o(e,n){return Array.prototype.concat.call(e).map(function(e){return n+e})}function f(e){return{ENTITY:["self","this","here"],ATTRIBUTE:o(["is","of","as"],e),ELEMENT:o(["import","include","if","else","endif","fi"],e),HELPER:o("as",e)}}function c(e){var n={t:e[1]},r=e[2];if(r){for(var t={},u=void 0;u=L.exec(r);)t[u[1]]=u[2]||!0;n.a=t}return n}function a(e){for(var n=[],r=e.length,t=0,u=void 0,i="";r>t;){var o=e.slice(t);"<"===o[0]?((u=A.exec(o))?(t+=u[0].length,u=c(u)):(u=k.exec(o))?(t+=u[0].length,u={t:"c"}):(u=B.exec(o))&&(t+=u[0].length,u=!1),u&&(i&&(n.push(i),i=""),n.push(u))):i+=e[t++]}return!u&&i?i:n}function l(e,n){var t=n[e];if("string"!=typeof t)return null;var u=void 0;(u=t.match(H))&&(r(j.ATTRIBUTE,function(e){var r=n[e];if(r){u.soft={i:r.replace(O,"")};var t=n[j.HELPER];t&&(u.soft.h=t.replace(O,""))}}),n[e]=u)}function p(e,n){var r=j.HELPER;if(e===r)return null;var t=n.a,u=t[e];n.c||(n.c=[]);var i={i:u},o=t[r];o&&(i.h=o),n.c.push(i)}function s(e){var t=e.a,u=[];r(Object.keys(t),function(r){n(j.ATTRIBUTE,r)?(p(r,e),u.push(r)):l(r,t)}),r(u,function(e){return delete t[e]}),e.a=t}function g(e,n){var r=e.t;if(r){if("c"===r)return n.pop(),null;e.a&&s(e)}var t=n[n.length-1],u="string"==typeof e;return t?(t.c||(t.c=[]),t.c.push(e),u||N.test(r)||n.push(e),null):u?null:(N.test(r)||n.push(e),e)}function h(e){var n=a(e);if("string"==typeof n)return n;null!=U.prefix&&(j=f(U.prefix));var r=[];return u(t(n,function(e){return r.length||"string"!=typeof e?g(e,r):e}),Boolean)}function v(e){var n=P[e]||(P[e]=h(e));return n=i(n.join("")),new Function("data","return '"+n+"'")}function d(e){return Object.assign(U,e),soft}function E(e,n){return v(e)(n)}var T=/'/g,m=/"/g,y=/\n/g,x=/\r/g,b=/\\/g,R=/\u2028/,I=/\u2029/,j=f(),A=/^<([^ \/!]+?)( [^>]+)*?>/,k=/^<\/(?:[^ \/]+?)(?: [^>]+)*?>/,B=/^<!--(.+?)-->/,L=/([^= ]+)(?:=("[^"]*"|'[^']*'|[^"'\s>]*))?/g,N=/^(?:area|base|br|col|command|doctype|embed|hr|img|input|keygen|link|meta|param|source|track|wbr|import|include)$/i,w=j.ENTITY.join("|"),H=new RegExp("&(?:"+w+");|&(?:"+w+")(?:\\.([^;]+)|\\[([^\\]]+)\\]);"),O=/^['"]|['"]$/g,P={},U={prefix:":"};e.parse=h,e.lex=a,e.compile=v,e.CONFIG=U,e.configure=d,e.render=E});