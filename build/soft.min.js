!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n(e.soft={})}(this,function(e){"use strict";function n(e,n){for(var r=0,t=-1+e.length,o=Math.floor((t+1)/2);o>=r;r++){if(e[r]===n)return!0;if(e[t-r]===n)return!0}return!1}function r(e,n){for(var r=-1,t=e.length;++r<t;)n(e[r],r,e)}function t(e,n){for(var r=-1,t=e.length,o=Array(t);++r<t;)o[r]=n(e[r],r,e);return o}function o(e,n){for(var r=-1,t=e.length,o=[];++r<t;)n(e[r])&&o.push(e[r]);return o}function u(e){return e.replace(E,"\\\\").replace(d,"\\'").replace(T,'\\"').replace(m,"\\n").replace(y,"\\r").replace(x,"\\u2028").replace(b,"\\u2029")}function i(e,n){return Array.prototype.concat.call(e).map(function(e){return(n||":")+e})}function c(e){return{ENTITY:["self","this","here"],ATTRIBUTE:i(["is","of","as"]),ELEMENT:i(["import","include","if","else","endif","fi"]),HELPER:i("as")}}function f(e){var n={t:e[1]},r=e[2];if(r){for(var t={},o=void 0;o=k.exec(r);)t[o[1]]=o[2]||!0;n.a=t}return n}function a(e){for(var n=[],r=e.length,t=0,o=void 0,u="";r>t;){var i=e.slice(t);"<"===i[0]?((o=A.exec(i))?(t+=o[0].length,o=f(o)):(o=I.exec(i))?(t+=o[0].length,o={t:"c"}):(o=j.exec(i))&&(t+=o[0].length,o=!1),o&&(u&&(n.push(u),u=""),n.push(o))):u+=e[t++]}return!o&&u?u:n}function l(e,n){var t=n[e];if("string"!=typeof t)return null;var o=void 0;(o=t.match(L))&&(n[e]=o,r(R.ATTRIBUTE,function(e){var r=n[e];if(r){o.soft={i:r.replace(N,"")};var t=n[R.HELPER];t&&(o.soft.h=t)}}))}function p(e){var t=e.a;r(Object.keys(t),function(r,o,u){n(R.ATTRIBUTE,r)?delete e.a[r]:l(r,t)})}function s(e,n){var r=e.t;if(r){if("c"===r)return n.pop(),null;e.a&&p(e)}var t=n[n.length-1],o="string"==typeof e;return t?(t.c||(t.c=[]),t.c.push(e),o||B.test(r)||n.push(e),null):o?null:(B.test(r)||n.push(e),e)}function g(e){var n=a(e);if("string"==typeof n)return n;var r=[];return o(t(n,function(e){return r.length||"string"!=typeof e?s(e,r):e}),Boolean)}function h(e){var n=U[e]||(U[e]=g(e));return n=u(n.join("")),new Function("data","return '"+n+"'")}function v(e,n){return h(e)(n)}var d=/'/g,T=/"/g,m=/\n/g,y=/\r/g,E=/\\/g,x=/\u2028/,b=/\u2029/,R=c(),A=/^<([^ \/!]+?)( [^>]+)*?>/,I=/^<\/(?:[^ \/]+?)(?: [^>]+)*?>/,j=/^<!--(.+?)-->/,k=/([^= ]+)(?:=("[^"]*"|'[^']*'|[^"'\s>]*))?/g,B=/^(?:area|base|br|col|command|doctype|embed|hr|img|input|keygen|link|meta|param|source|track|wbr|import|include)$/i,w=R.ENTITY.join("|"),L=new RegExp("&(?:"+w+");|&(?:"+w+")(?:\\.([^;]+)|\\[([^\\]]+)\\]);"),N=/['"]/g,U={};e.parse=g,e.lex=a,e.compile=h,e.render=v});