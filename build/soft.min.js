!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n(e.soft={})}(this,function(e){"use strict";function n(e,n){for(var t=0,r=-1+e.length,o=Math.floor((r+1)/2);o>=t;t++){if(e[t]===n)return!0;if(e[r-t]===n)return!0}return!1}function t(e,n){for(var t=-1,r=e.length;++t<r;)n(e[t],t,e)}function r(e,n){for(var t=-1,r=e.length,o=Array(r);++t<r;)o[t]=n(e[t],t,e);return o}function o(e,n){for(var t=-1,r=e.length,o=[];++t<r;)n(e[t])&&o.push(e[t]);return o}function u(e){return e.replace(E,"\\\\").replace(v,"\\'").replace(m,'\\"').replace(b,"\\n").replace(T,"\\r").replace(x,"\\u2028").replace(j,"\\u2029")}function i(e,n){return Array.prototype.concat.call(e).map(function(e){return(n||":")+e})}function f(e){return{ENTITY:["self","this","here"],ATTRIBUTE:i(["is","of","as"]),ELEMENT:i(["import","include","if","else","endif","fi"]),HELPER:i("as")}}function c(e){var n={t:e[1]},t=e[2];if(t){for(var r={},o=void 0;o=S.exec(t);)r[o[1]]=o[2]||!0;n.a=r}return n}function a(e){for(var n=[],t=e.length,r=0,o=void 0,u="";t>r;){var i=e.slice(r);"<"===i[0]?((o=A.exec(i))?(r+=o[0].length,o=c(o)):(o=I.exec(i))?(r+=o[0].length,o={t:"c"}):(o=R.exec(i))&&(r+=o[0].length,o=!1),o&&(u&&(n.push(u),u=""),n.push(o))):u+=e[r++]}return!o&&u?u:n}function l(e,n){var t=n[e];if("string"===!("undefined"==typeof t?"undefined":h["typeof"](t)))return null;console.log(t);var r=void 0;(r=t.match(N))&&(n[e]=[t,r])}function p(e){var r=e.a;t(Object.keys(r),function(t,o,u){n(k.ATTRIBUTE,t)?delete e.a[t]:l(t,r)})}function s(e,n){var t=e.t;if(t){if("c"===t)return n.pop(),null;e.a&&p(e)}var r=n[n.length-1],o="string"==typeof e;return r?(r.c||(r.c=[]),r.c.push(e),o||w.test(t)||n.push(e),null):o?null:(w.test(t)||n.push(e),e)}function y(e){var n=a(e);if("string"==typeof n)return n;var t=[];return o(r(n,function(e){return t.length||"string"!=typeof e?s(e,t):e}),Boolean)}function g(e){var n=L[e]||(L[e]=y(e));return n=u(n.join("")),new Function("data","return '"+n+"'")}function d(e,n){return g(e)(n)}var h={};h["typeof"]="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};var v=/'/g,m=/"/g,b=/\n/g,T=/\r/g,E=/\\/g,x=/\u2028/,j=/\u2029/,k=f(),A=/^<([^ \/!]+?)( [^>]+)*?>/,I=/^<\/(?:[^ \/]+?)(?: [^>]+)*?>/,R=/^<!--(.+?)-->/,S=/([^= ]+)(?:=("[^"]*"|'[^']*'|[^"'\s>]*))?/g,w=/^(?:area|base|br|col|command|doctype|embed|hr|img|input|keygen|link|meta|param|source|track|wbr|import|include)$/i,B=k.ENTITY.join("|"),N=new RegExp("&(?:"+B+");|&(?:"+B+")(?:\\.([^;]+)|\\[([^\\]]+)\\]);"),L={};e.parse=y,e.lex=a,e.compile=g,e.render=d});