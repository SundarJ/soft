!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n(e.soft=e.soft||{})}(this,function(e){"use strict";function n(e,n){for(var r=0,t=-1+e.length,i=Math.floor((t+1)/2);i>=r;r++){if(e[r]===n)return!0;if(e[t-r]===n)return!0}return!1}function r(e,n){for(var r=-1,t=e.length;++r<t;)n(e[r],r,e)}function t(e,n){for(var r=-1,t=e.length,i=Array(t);++r<t;)i[r]=n(e[r],r,e);return i}function i(e,n){for(var r=-1,t=e.length,i=[];++r<t;)n(e[r])&&i.push(e[r]);return i}function u(e){return e.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\u2028/,"\\u2028").replace(/\u2029/,"\\u2029")}function o(e,n){return"string"==typeof e?n+e:e.map(function(e){return n+e})}function f(e){return{ENTITY:["self","this","here"],ATTRIBUTE:o(["is","of","as"],e),ELEMENT:o(["import","include","if","else","endif","fi"],e),HELPER:o("as",e)}}function c(e){var n={t:e[1]},r=e[2];if(r){for(var t={},i=void 0;i=b.exec(r);)t[i[1]]=i[2]||!0;n.a=t}return n}function a(e){for(var n=[],r=e.length,t=0,i=void 0,u="";r>t;){var o=e.slice(t);"<"===o[0]?((i=m.exec(o))?(t+=i[0].length,i=c(i)):(i=x.exec(o))?(t+=i[0].length,i={t:"c"}):(i=y.exec(o))&&(t+=i[0].length,i=!1),i&&(u&&(n.push(u),u=""),n.push(i))):u+=e[t++]}return!i&&u?u:n}function p(e,n){var t=n[e];if("string"==typeof t){var i=void 0;(i=t.match(I))&&(r(T.ATTRIBUTE,function(e){var r=n[e];if(r){i.soft={i:r.replace(k,"")};var t=n[T.HELPER];t&&(i.soft.h=t.replace(k,""))}}),n[e]=Object.assign({},i))}}function l(e,n){var r=T.HELPER;if(e!==r){var t=n.a,i=t[e];n.c||(n.c=[]);var u={i:i.replace(k,"")},o=t[r];o&&(u.h=o.replace(k,"")),n.c.push(u)}}function s(e){var t=e.a,i=[];r(Object.keys(t),function(r){n(T.ATTRIBUTE,r)?(l(r,e),i.push(r)):p(r,t)}),r(i,function(e){return delete t[e]}),e.a=t}function g(e,n){var r=e.t;if(r){if("c"===r)return n.pop(),null;e.a&&s(e)}var t=n[n.length-1],i="string"==typeof e;return t?(t.c||(t.c=[]),t.c.push(e),i||R.test(r)||n.push(e),null):i?null:(R.test(r)||n.push(e),e)}function h(e){var n=a(e);if("string"==typeof n)return n;null!=B.prefix&&(T=f(B.prefix));var r=[];return i(t(n,function(e){return r.length||"string"!=typeof e?g(e,r):e}),Boolean)}function v(e){var n=A[e]||(A[e]=h(e));return n=u(n.join("")),new Function("data","return '"+n+"'")}function d(e){return Object.assign(B,e),soft}function E(e,n){return v(e)(n)}var T=f(),m=/^<([^ \/!]+?)( [^>]+)*?>/,x=/^<\/(?:[^ \/]+?)(?: [^>]+)*?>/,y=/^<!--(.+?)-->/,b=/([^= ]+)(?:=("[^"]*"|'[^']*'|[^"'\s>]*))?/g,R=/^(?:area|base|br|col|command|doctype|embed|hr|img|input|keygen|link|meta|param|source|track|wbr|import|include)$/i,j=T.ENTITY.join("|"),I=new RegExp("&(?:"+j+");|&(?:"+j+")(?:\\.([^;]+)|\\[([^\\]]+)\\]);"),k=/^['"]|['"]$/g,A={},B={prefix:":"};e.parse=h,e.lex=a,e.compile=v,e.config=B,e.configure=d,e.render=E});